import{_ as $,r as c,u as O,i as T,j as U,g as D,w as a,d as n,n as E,o as k,b as o,e as g,f as _,c as b,F,k as J,t as K,l as L}from"./index-BdyWt8Po.js";const P={style:{display:"flex","margin-left":"auto",gap:"10px"}},j={__name:"chats",setup(q){const i=O(),d=c(""),m=c([]);let t=null;const f=c(null),r=c(!0),l=c(i.state.userInfo.nickname||""),h=c(!1),v=()=>{E(()=>{requestAnimationFrame(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})})},V=()=>{l.value.trim()&&(t&&t.readyState===WebSocket.OPEN&&(t.close(),t=null),i.commit("nickname",l.value),r.value=!1,w())},y=()=>{if(d.value&&t?.readyState===WebSocket.OPEN){const p=JSON.stringify({nickname:l.value,content:d.value,create_time:new Date().toLocaleString().replace(/\//g,"-")});t.send(p),d.value=""}},w=()=>{t=new WebSocket("wss://server.thornasa.com:7001/chat/ws"),t.onopen=()=>{m.value.push(`✅ ${l.value} 已進入聊天室`),h.value=!0,v()},t.onmessage=p=>{try{const e=JSON.parse(p.data),u=`${e.nickname} ${e.create_time} 說：
${e.content}`;m.value.push(u)}catch{m.value.push(p.data)}v()},t.onclose=()=>{m.value.push("❌ 已與聊天室斷開連接"),h.value=!1,v()}},S=()=>{};return T(()=>{t?.close(),t=null}),U(()=>{i.state.userInfo.nickname&&i.state.userInfo.nickname.trim()?(l.value=i.state.userInfo.nickname,r.value=!1,w()):r.value=!0}),(p,e)=>{const u=n("el-button"),C=n("el-header"),N=n("el-main"),x=n("el-input"),B=n("el-footer"),I=n("el-dialog"),M=n("el-container");return k(),D(M,{class:"chat-container"},{default:a(()=>[o(C,{height:"60px",class:"chat-header"},{default:a(()=>[e[6]||(e[6]=g("span",{class:"chat-title"},"聊天室",-1)),g("div",P,[o(u,{type:"info",onClick:S,style:{color:"white"}},{default:a(()=>e[4]||(e[4]=[_(" 查詢聊天記錄 ")])),_:1,__:[4]}),o(u,{type:"info",onClick:e[0]||(e[0]=s=>r.value=!0),style:{color:"white"}},{default:a(()=>e[5]||(e[5]=[_(" 修改暱稱 ")])),_:1,__:[5]})])]),_:1,__:[6]}),o(N,{class:"chat-main"},{default:a(()=>[g("div",{class:"chat-messages",ref_key:"chatWindow",ref:f},[(k(!0),b(F,null,J(m.value,(s,W)=>(k(),b("div",{key:W,class:"chat-message",style:{"white-space":"pre-wrap","word-break":"break-word",padding:"4px 8px",background:"#f0f0f0","border-radius":"4px","margin-bottom":"8px"}},K(s),1))),128))],512)]),_:1}),o(B,{height:"80px",class:"chat-footer"},{default:a(()=>[o(x,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),placeholder:"輸入訊息...",onKeyup:L(y,["enter"]),class:"chat-input"},null,8,["modelValue"]),o(u,{type:"info",onClick:y,class:"chat-button"},{default:a(()=>e[7]||(e[7]=[_(" 發送 ")])),_:1,__:[7]})]),_:1}),o(I,{title:"請輸入你的暱稱",modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value=s),width:"400px","close-on-click-modal":!1,"show-close":!1,"align-center":""},{footer:a(()=>[o(u,{type:"primary",onClick:V,disabled:!l.value},{default:a(()=>e[8]||(e[8]=[_(" 進入聊天室 ")])),_:1,__:[8]},8,["disabled"])]),default:a(()=>[o(x,{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value=s),placeholder:"你的暱稱"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}},H=$(j,[["__scopeId","data-v-d20da1c4"]]);export{H as default};
